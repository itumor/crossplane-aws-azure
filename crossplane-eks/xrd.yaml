---
apiVersion: apiextensions.crossplane.io/v1
kind: CompositeResourceDefinition
metadata:
  # XRDs must be named 'x<plural>.<group>'
  name: xeksclusters.crossplane.jonashackt.io
spec:
  # This XRD defines an XR in the 'crossplane.jonashackt.io' API group.
  # The XR or Claim must use this group together with the spec.versions[0].name as it's apiVersion, like this:
  # 'crossplane.jonashackt.io/v1alpha1'
  group: crossplane.jonashackt.io
  # XR names should always be prefixed with an 'X'
  names:
    kind: XEKSCluster
    plural: xeksclusters
  # This type of XR offers a claim, which should have the same name without the 'X' prefix
  claimNames:
    kind: EKSCluster
    plural: eksclusters
  # The keys the XR writes to it's connection secret
  # which will act as a filter during aggregation of the connection secret from
  # composed resources.
  connectionSecretKeys:
    - kubeconfig
  # default Composition when none is specified (must match metadata.name of a provided Composition)
  # e.g. in composition.yaml
  defaultCompositionRef:
    name: eks-cluster
  # version of this XR
  versions:
  - name: v1alpha1
    served: true
    referenceable: true
    # OpenAPI schema (like the one used by Kubernetes CRDs). Determines what fields
    # the XR (and claim) will have. Will be automatically extended by crossplane.
    # See https://kubernetes.io/docs/tasks/extend-kubernetes/custom-resources/custom-resource-definitions/
    # for full CRD documentation and guide on how to write OpenAPI schemas
    schema:
      openAPIV3Schema:
        type: object
        properties:
          spec:
            type: object
            properties:
              parameters:
                type: object
                properties:
                  region:
                    description: Geographic location of this VPC
                    type: string       
                    enum: ["us-east-1", "us-west-2"]   
                    
                  vpc-cidrBlock:
                    description: CIDR block for VPC
                    type: string   
                  vpc-name:
                    description: Name for VPC
                    type: string       

                  subnet1-public-name:
                    description: Name for public subnet 1
                    type: string  
                  subnet1-public-cidrBlock:
                    description: CIDR block for public subnet 1
                    type: string
                  subnet1-public-availabilityZone:
                    description: AZ for public subnet 1
                    type: string                      

                  subnet2-public-name:
                    description: Name for public subnet 2
                    type: string  
                  subnet2-public-cidrBlock:
                    description: CIDR block for public subnet 2
                    type: string  
                  subnet2-public-availabilityZone:
                    description: AZ for public subnet 2
                    type: string   

                  subnet1-private-name:
                    description: Name for private subnet 1
                    type: string  
                  subnet1-private-cidrBlock:
                    description: CIDR block for private subnet 1
                    type: string
                  subnet1-private-availabilityZone:
                    description: AZ for private subnet 1
                    type: string                      

                  subnet2-private-name:
                    description: Name for private subnet 2
                    type: string  
                  subnet2-private-cidrBlock:
                    description: CIDR block for private subnet 2
                    type: string  
                  subnet2-private-availabilityZone:
                    description: AZ for private subnet 2
                    type: string  

                  cluster-role:
                    description: EKS cluster role
                    type: string     
                  workernode-role:
                    description: EKS worker node role
                    type: string                                       

                  k8s-version:
                    description: Kubernetes version
                    type: string
                    enum: ["1.20", "1.21", "1.22"]    
                  workers-size:
                    description: Desired number of worker nodes in the cluster
                    type: integer
                  workload-type:
                    description: Type of workloads to be run on this cluster (GPU or non-GPU)"
                    type: string       
                    enum: ["gpu", "non-gpu"]                       
                    
                required:
                  - region
                  - vpc-name
                  - vpc-cidrBlock
                  - subnet1-public-name
                  - subnet1-public-cidrBlock
                  - subnet1-public-availabilityZone
                  - subnet2-public-name
                  - subnet2-public-cidrBlock
                  - subnet2-public-availabilityZone
                  - subnet1-private-name
                  - subnet1-private-cidrBlock
                  - subnet1-private-availabilityZone
                  - subnet2-private-name
                  - subnet2-private-cidrBlock
                  - subnet2-private-availabilityZone    
                  - k8s-version
                  - workers-size
                  - workload-type   
                  - cluster-role     
                  - workernode-role      
            required:
              - parameters